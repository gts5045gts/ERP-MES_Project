<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<head>
    <th:block layout:fragment="style">
    <style>
	        .table-compact th,
	        .table-compact td {
	            padding: 0.5rem;
	            vertical-align: middle;
	        }
	        
	        /* ê²°ì¬ ìƒíƒœ ì „ìš© ë°°ì§€ ìŠ¤íƒ€ì¼ */
	        .approval-status-badge {
	            font-size: 0.8rem;
	            padding: 0.4rem 0.8rem;
	            border-radius: 20px;
	            font-weight: 500;
	            display: inline-block;
	            text-align: center;
	            min-width: 60px;
	        }
	        
	        /* ìŠ¹ì¸ - ì—°í•œ íŒŒë‘ */
	        .approval-status-approved {
	            background-color: #d1ecf1 !important;
	            color: #0c5460 !important;
	            border: 1px solid #bee5eb;
	        }
	        
	        /* ëŒ€ê¸° - ì—°í•œ ë…¸ë‘ */
	        .approval-status-pending {
	            background-color: #fff3cd !important;
	            color: #856404 !important;
	            border: 1px solid #ffeaa7;
	        }
	        
	        /* ë°˜ë ¤ - ì—°í•œ ë¹¨ê°• */
	        .approval-status-rejected {
	            background-color: #f8d7da !important;
	            color: #721c24 !important;
	            border: 1px solid #f5c6cb;
	        }
	        
	        /* ë¯¸ì • - íšŒìƒ‰ */
	        .approval-status-unknown {
	            background-color: #e2e3e5 !important;
	            color: #383d41 !important;
	            border: 1px solid #d6d8db;
	        }
	        
	        /* í˜¸ë²„ íš¨ê³¼ */
	        .approval-status-badge:hover {
	            transform: scale(1.05);
	            transition: transform 0.2s ease;
	            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
	        }
	        
	        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
	        .modal-header {
	            background-color: #4e73df;
	            color: white;
	        }
	        
	        .info-row {
	            margin-bottom: 15px;
	            padding: 10px;
	            background-color: #f8f9fc;
	            border-radius: 5px;
	        }
	        
	        .info-label {
	            font-weight: bold;
	            color: #5a5c69;
	            margin-bottom: 5px;
	        }
	        
	        .info-value {
	            color: #3a3b45;
	            font-size: 14px;
	        }
	    </style>
	</th:block>
</head>

<body>
    <th:block layout:fragment="content">
        <div class="container-fluid">

            <h1 class="h3 mb-4 text-gray-800">ì¸ì‚¬ ê²°ì¬ ëª©ë¡</h1>

            <div class="card shadow mb-4">
                <div class="card-body">
                    <form onsubmit="return false;">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <input type="date" class="form-control" value="2025-07-13">
                                    <span class="input-group-text">~</span>
                                    <input type="date" class="form-control" value="2025-08-12">
                                </div>
                            </div>
                            <div class="col-md-1">
                                <select class="form-control">
                                    <option selected>ê²°ì¬ìœ í˜•</option>
                                    <option value="1">ì¶œì¥</option>
                                    <option value="2">ì¸ì‚¬ë°œë ¹</option>
                                    <option value="3">íœ´ê°€</option>
                                </select>
                            </div>
                            <div class="col-md-1">
                                <select class="form-control">
                                    <option selected>ë¶€ì„œ</option>
                                    <option value="1">ìƒì‚°</option>
                                    <option value="2">ì¸ì‚¬</option>
                                    <option value="3">ì¬ë¬´</option>
                                </select>
                            </div>
                            <div class="col-md-1">
                                <select class="form-control">
                                    <option selected>ì§ê¸‰</option>
                                    <option value="1">ì‚¬ì›</option>
                                    <option value="2">ì£¼ì„</option>
                                    <option value="3">ëŒ€ë¦¬</option>
                                </select>
                            </div>
                            <div class="col-md-3 ml-auto">
                                <input type="text" class="form-control" id="drafterNameInput" placeholder="ê¸°ì•ˆì ì…ë ¥ í›„ ê²€ìƒ‰">
                            </div>
                            <div class="col-md-1">
                                <button class="btn btn-primary" id="searchButton" type="button">ê²€ìƒ‰</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <ul class="nav nav-tabs card-header-tabs">
					    <li class="nav-item">
					        <a class="nav-link" th:classappend="${currentStatus == 'all' ? 'active' : ''}" 
					           th:href="@{/approval/approval_list(status='all')}">ì „ì²´ê²°ì¬</a>
					    </li>
					    <li class="nav-item">
					        <a class="nav-link" th:classappend="${currentStatus == 'pending' ? 'active' : ''}" 
					           th:href="@{/approval/approval_list(status='pending')}">ê²°ì¬ëŒ€ê¸°</a>
					    </li>
					    <li class="nav-item">
					        <a class="nav-link" th:classappend="${currentStatus == 'completed' ? 'active' : ''}" 
					           th:href="@{/approval/approval_list(status='completed')}">ê²°ì¬ì™„ë£Œ</a>
					    </li>
					</ul>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover text-center table-compact" id="dataTable" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>ê²°ì¬ìˆœë²ˆ</th>
                                    <th>ë¬¸ì„œì œëª©</th>
                                    <th>ê¸°ì•ˆì</th>
                                    <th>ë¶€ì„œëª…</th>
                                    <th>ìƒì„±ì¼</th>
                                    <th>ê²°ì¬ ì™„ë£Œì¼ì</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ê²°ì¬ì—¬ë¶€</th>
                                </tr>
                            </thead>
                            
                            <!-- ã…‡ã…‡ -->
                            <tbody>
						    <tr th:each="appr : ${approvalList}">
						        <td th:text="${appr.stepNo}">1</td> <!-- ê²°ì¬ìˆœë²ˆ -->
						        <td th:text="${appr.title}">íœ´ê°€ ì‹ ì²­ì„œ</td> <!-- ë¬¸ì„œì œëª© -->
						        <td th:text="${appr.drafterName}">ì´ì—°ìˆ˜</td> <!-- ê¸°ì•ˆì -->
						        <td th:text="${appr.department}">ì¬ë¬´íŒ€</td> <!-- ë¶€ì„œëª… -->
						        <td th:text="${#temporals.format(appr.createAt, 'yyyy-MM-dd')}">2025-08-07</td> <!-- ìƒì„±ì¼ -->
						        <td th:text="${appr.decDate != null ? #temporals.format(appr.decDate, 'yyyy-MM-dd') : '-'}">-</td> <!-- ê²°ì¬ì¼ì -->
						        <td>
								    <span th:text="${appr.statusLabel}" 
								          th:class="'approval-status-badge ' + 
								                   ${appr.statusLabel == 'ìŠ¹ì¸' ? 'approval-status-approved' : 
								                     appr.statusLabel == 'ëŒ€ê¸°' ? 'approval-status-pending' : 
								                     appr.statusLabel == 'ë°˜ë ¤' ? 'approval-status-rejected' : 
								                     'approval-status-unknown'}">ëŒ€ê¸°</span>
								</td>
						        <td>
						            <button th:if="${appr.statusLabel == 'ëŒ€ê¸°'}"
						                    type="button" class="btn btn-primary btn-sm"
						                    th:onclick="'openApprovalModal(' + ${appr.reqId} + ')'">ê²°ì¬í•˜ê¸°</button>
						        </td>
						    </tr>
						</tbody>
                        </table>
                    </div>

                    <nav aria-label="Page navigation">
					    <ul class="pagination justify-content-center">
					        <!-- ì´ì „ ë²„íŠ¼ -->
					        <li class="page-item" th:classappend="${!hasPrevious} ? 'disabled'">
					            <a class="page-link" 
					               th:href="${hasPrevious} ? @{/approval/approval_list(status=${currentStatus}, page=${currentPage - 1})} : '#'" 
					               tabindex="-1">ì´ì „</a>
					        </li>
					        
					        <!-- í˜ì´ì§€ ë²ˆí˜¸ë“¤ -->
					        <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}" th:if="${totalPages > 0}">
					            <li class="page-item" th:classappend="${i == currentPage} ? 'active'">
					                <a class="page-link" 
					                   th:href="@{/approval/approval_list(status=${currentStatus}, page=${i})}" 
					                   th:text="${i + 1}">1</a>
					            </li>
					        </th:block>
					        
					        <!-- ë‹¤ìŒ ë²„íŠ¼ -->
					        <li class="page-item" th:classappend="${!hasNext} ? 'disabled'">
					            <a class="page-link" 
					               th:href="${hasNext} ? @{/approval/approval_list(status=${currentStatus}, page=${currentPage + 1})} : '#'">ë‹¤ìŒ</a>
					        </li>
					    </ul>
					    
					    <!-- í˜ì´ì§€ ì •ë³´ í‘œì‹œ -->
					    <div class="text-center mt-2">
					        <small class="text-muted">
					            ì´ <span th:text="${totalElements}">0</span>ê±´ ì¤‘ 
					            <span th:text="${currentPage * 5 + 1}">1</span> - 
					            <span th:text="${(currentPage + 1) * 5 > totalElements ? totalElements : (currentPage + 1) * 5}">5</span>ê±´ í‘œì‹œ
					        </small>
					    </div>
					</nav>
                </div>
            </div>
        </div>

        <div class="modal fade" id="approvalModal" tabindex="-1" role="dialog" aria-labelledby="approvalModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="approvalModalLabel">
                            <i class="fas fa-clipboard-check"></i> ê²°ì¬ ë¬¸ì„œ ìƒì„¸
                        </h5>
                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="modalLoading" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="sr-only">ë¡œë”©ì¤‘...</span>
                            </div>
                            <p class="mt-2">ê²°ì¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
                        </div>

                        <div id="modalContent" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="info-row">
                                        <div class="info-label">ê²°ì¬ë²ˆí˜¸</div>
                                        <div class="info-value" id="modal-reqId">-</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="info-row">
                                        <div class="info-label">ê²°ì¬ ìœ í˜•</div>
                                        <div class="info-value" id="modal-reqType">-</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="info-row">
                                        <div class="info-label">ê¸°ì•ˆì</div>
                                        <div class="info-value" id="modal-drafterName">-</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="info-row">
                                        <div class="info-label">ë¶€ì„œ</div>
                                        <div class="info-value" id="modal-department">-</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="info-row">
                                        <div class="info-label">ê¸°ì•ˆì¼</div>
                                        <div class="info-value" id="modal-createAt">-</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="info-row">
                                        <div class="info-label">ì œëª©</div>
                                        <div class="info-value" id="modal-title">-</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="info-row">
                                        <div class="info-label">ë‚´ìš©</div>
                                        <div class="info-value" id="modal-content-detail" style="min-height: 100px; white-space: pre-wrap;">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
						<!-- ìŠ¹ì¸/ë°˜ë ¤ ì‚¬ìœ  ì…ë ¥ -->
						<div class="row">
						    <div class="col-md-12">
						        <div class="info-row">
						            <div class="info-label">
						                <i class="fas fa-comment"></i> ìŠ¹ì¸/ë°˜ë ¤ ì‚¬ìœ 
						                <small class="text-muted">(ì„ íƒì‚¬í•­)</small>
						            </div>
						            <textarea class="form-control" 
						                      id="modal-comments" 
						                      rows="3" 
						                      placeholder="ìŠ¹ì¸ ë˜ëŠ” ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
						                      maxlength="500"></textarea>
						            <small class="form-text text-muted">ìµœëŒ€ 500ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.</small>
						        </div>
						    </div>
						</div>
                        <div id="modalError" style="display: none;" class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            ê²°ì¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">ë‹«ê¸°</button>
                        <button type="button" class="btn btn-success" id="approveBtn">ìŠ¹ì¸</button>
                        <button type="button" class="btn btn-danger" id="rejectBtn">ë°˜ë ¤</button>
                    </div>
                </div>
            </div>
        </div>
    </th:block>

    <th:block layout:fragment="script">
        <script th:inline="javascript">
     // HTMLì˜ JavaScript ë¶€ë¶„ì— ì´ ì½”ë“œë“¤ì„ ì¶”ê°€í•´ì¤˜!

     // ===== ë¹ ì§„ ëª¨ë‹¬ ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜ë“¤ =====

     // ëª¨ë‹¬ ë¡œë”© ìƒíƒœ ë³´ì—¬ì£¼ê¸°
     function showModalLoading() {
         document.getElementById('modalLoading').style.display = 'block';
         document.getElementById('modalContent').style.display = 'none';
         document.getElementById('modalError').style.display = 'none';
     }

     // ëª¨ë‹¬ ì—ëŸ¬ ìƒíƒœ ë³´ì—¬ì£¼ê¸°
     function showModalError() {
         document.getElementById('modalLoading').style.display = 'none';
         document.getElementById('modalContent').style.display = 'none';
         document.getElementById('modalError').style.display = 'block';
     }

     // ===== ëª¨ë‹¬ ê´€ë ¨ ë³€ìˆ˜ ë° í•¨ìˆ˜ë“¤ =====

     let currentReqId = null; // í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ ê²°ì¬ IDë¥¼ ì €ì¥

     // ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜ (ë””ë²„ê¹… ë²„ì „)
     function openApprovalModal(reqId) {
    	    console.log('ğŸ”¥ ëª¨ë‹¬ ì—´ê¸° ì‹œì‘ - reqId:', reqId);
    	    
    	    // reqId ìœ íš¨ì„± ê²€ì‚¬
    	    if (!reqId) {
    	        console.error('âŒ reqIdê°€ ì—†ìŠµë‹ˆë‹¤!');
    	        alert('ê²°ì¬ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
    	        return;
    	    }
    	    
    	    // í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ reqId ì €ì¥
    	    currentReqId = reqId;
    	    console.log('âœ… currentReqId ì €ì¥ë¨:', currentReqId);
    	    
    	    // comments ì…ë ¥ì°½ ì´ˆê¸°í™” (ìƒˆë¡œ ì¶”ê°€!)
    	    document.getElementById('modal-comments').value = '';
    	    
    	    // ëª¨ë‹¬ ì—´ê¸°
    	    $('#approvalModal').modal('show');
    	    console.log('âœ… ëª¨ë‹¬ ì—´ê¸° ì™„ë£Œ');
    	    
    	    // ë¡œë”© ìƒíƒœ í‘œì‹œ
    	    showModalLoading();
    	    console.log('âœ… ë¡œë”© ìƒíƒœ í‘œì‹œ ì™„ë£Œ');
    	    
    	    // API URL í™•ì¸
    	    const apiUrl = `/approval/api/detail/${reqId}`;
    	    console.log('ğŸŒ API ìš”ì²­ URL:', apiUrl);
    	    
    	    // ì„œë²„ì— ë°ì´í„° ìš”ì²­
    	    fetch(apiUrl)
    	        .then(response => {
    	            console.log('ğŸ“¡ ì„œë²„ ì‘ë‹µ ë°›ìŒ - ìƒíƒœì½”ë“œ:', response.status);
    	            console.log('ğŸ“¡ ì‘ë‹µ OK ì—¬ë¶€:', response.ok);
    	            
    	            if (!response.ok) {
    	                throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ' + response.status);
    	            }
    	            return response.json();
    	        })
    	        .then(data => {
    	            console.log('âœ… ì„œë²„ ë°ì´í„° íŒŒì‹± ì„±ê³µ:', data);
    	            displayModalContent(data);
    	        })
    	        .catch(error => {
    	            console.error('âŒ ì—ëŸ¬ ë°œìƒ:', error);
    	            showModalError();
    	        });
    	}

     // ëª¨ë‹¬ ë‚´ìš© í‘œì‹œ í•¨ìˆ˜ (ë””ë²„ê¹… ë²„ì „)
     function displayModalContent(data) {
         console.log('ğŸ¨ ëª¨ë‹¬ ë‚´ìš© í‘œì‹œ ì‹œì‘:', data);
         
         try {
             // ê° í•„ë“œë³„ë¡œ í•˜ë‚˜ì”© ì„¤ì •í•˜ë©´ì„œ ë¡œê·¸ ì¶œë ¥
             console.log('Setting reqId:', data.reqId);
             document.getElementById('modal-reqId').textContent = data.reqId || '-';
             
             console.log('Setting reqType:', data.reqType);
             document.getElementById('modal-reqType').textContent = data.reqType || '-';
             
             console.log('Setting drafterName:', data.drafterName);
             document.getElementById('modal-drafterName').textContent = data.drafterName || '-';
             
             console.log('Setting department:', data.department);
             document.getElementById('modal-department').textContent = data.department || '-';
             
             console.log('Setting title:', data.title);
             document.getElementById('modal-title').textContent = data.title || '-';
             
             console.log('Setting content:', data.content);
             document.getElementById('modal-content-detail').textContent = data.content || '-';
             
             // ë‚ ì§œ ì²˜ë¦¬
             if (data.createAt) {
                 console.log('Setting createAt:', data.createAt);
                 const createDate = new Date(data.createAt);
                 document.getElementById('modal-createAt').textContent = createDate.toLocaleDateString('ko-KR');
             } else {
                 console.log('createAtì´ ì—†ìŒ');
                 document.getElementById('modal-createAt').textContent = '-';
             }

             // í™”ë©´ ì „í™˜
             document.getElementById('modalLoading').style.display = 'none';
             document.getElementById('modalContent').style.display = 'block';
             document.getElementById('modalError').style.display = 'none';
             
             console.log('âœ… ëª¨ë‹¬ ë‚´ìš© í‘œì‹œ ì™„ë£Œ!');
             
         } catch (error) {
             console.error('âŒ ëª¨ë‹¬ ë‚´ìš© í‘œì‹œ ì¤‘ ì—ëŸ¬:', error);
             showModalError();
         }
     }

     // ===== DOM ë¡œë“œ ì™„ë£Œ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ =====
     document.addEventListener('DOMContentLoaded', function () {
         
         // ìŠ¹ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
         document.getElementById('approveBtn').addEventListener('click', function() {
		    const userConfirmed = confirm('ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
		    
		    if (userConfirmed) {
		        // comments ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
		        const comments = document.getElementById('modal-comments').value.trim();
		        
		        // ì„œë²„ì— ìŠ¹ì¸ ìš”ì²­ ë³´ë‚´ê¸° (comments í¬í•¨)
		        fetch(`/approval/api/approve/${currentReqId}`, {
		            method: 'POST',
		            headers: {
		                'Content-Type': 'application/json'
		            },
		            body: JSON.stringify({
		                comments: comments
		            })
		        })
		        .then(response => {
		            if (!response.ok) {
		                throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + response.status);
		            }
		            return response.text();
		        })
		        .then(message => {
		            // ì„±ê³µ ì‹œ
		            alert('ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
		            $('#approvalModal').modal('hide');
		            
		            // í…Œì´ë¸”ì—ì„œ í•´ë‹¹ í–‰ì˜ ìƒíƒœì™€ ë‚ ì§œ ì—…ë°ì´íŠ¸
		            updateTableRow(currentReqId, 'ìŠ¹ì¸');
		        })
		        .catch(error => {
		            console.error('ìŠ¹ì¸ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
		            alert('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
		        });
		    }
		});

         // ë°˜ë ¤ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸  
         document.getElementById('rejectBtn').addEventListener('click', function() {
		    const userConfirmed = confirm('ë°˜ë ¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
		    
		    if (userConfirmed) {
		        // comments ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
		        const comments = document.getElementById('modal-comments').value.trim();
		        
		        // commentsê°€ ë¹„ì–´ìˆìœ¼ë©´ í™•ì¸ (ë°˜ë ¤ì‹œì—ë§Œ)
		        if (!comments) {
		            const confirmEmpty = confirm('ë°˜ë ¤ ì‚¬ìœ ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ë°˜ë ¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
		            if (!confirmEmpty) {
		                return; // ì·¨ì†Œí•˜ë©´ í•¨ìˆ˜ ì¢…ë£Œ
		            }
		        }
		        
		        // ì„œë²„ì— ë°˜ë ¤ ìš”ì²­ ë³´ë‚´ê¸° (comments í¬í•¨)
		        fetch(`/approval/api/reject/${currentReqId}`, {
		            method: 'POST',
		            headers: {
		                'Content-Type': 'application/json'
		            },
		            body: JSON.stringify({
		                comments: comments
		            })
		        })
		        .then(response => {
		            if (!response.ok) {
		                throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + response.status);
		            }
		            return response.text();
		        })
		        .then(message => {
		            // ì„±ê³µ ì‹œ
		            alert('ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤!');
		            $('#approvalModal').modal('hide');
		            
		            // í…Œì´ë¸”ì—ì„œ í•´ë‹¹ í–‰ì˜ ìƒíƒœì™€ ë‚ ì§œ ì—…ë°ì´íŠ¸
		            updateTableRow(currentReqId, 'ë°˜ë ¤');
		        })
		        .catch(error => {
		            console.error('ë°˜ë ¤ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
		            alert('ë°˜ë ¤ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
		        });
		    }
		});

         // ê²€ìƒ‰ ê¸°ëŠ¥ (ê¸°ì¡´)
         const drafterNameInput = document.getElementById('drafterNameInput');
         const searchButton = document.getElementById('searchButton');
         
         function searchByDrafter() {
             const searchTerm = drafterNameInput.value.trim().toLowerCase();
             const tableRows = document.querySelectorAll('#dataTable tbody tr');
             
             tableRows.forEach(function (row) {
                 if (row.cells.length === 1 && row.cells[0].colSpan === 8) {
                     return;
                 }

                 const drafterCell = row.querySelector('td:nth-child(3)');
                 
                 if (drafterCell) {
                     const drafterName = drafterCell.textContent.trim().toLowerCase();
                     
                     if (drafterName.includes(searchTerm)) {
                         row.style.display = '';
                     } else {
                         row.style.display = 'none';
                     }
                 }
             });
         }

         searchButton.addEventListener('click', searchByDrafter);
         
         drafterNameInput.addEventListener('keydown', function(event) {
             if (event.key === 'Enter') {
                 searchByDrafter();
             }
         });
     });

     // í…Œì´ë¸” í–‰ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
     function updateTableRow(reqId, newStatus) {
         // ëª¨ë“  í…Œì´ë¸” í–‰ì„ ìˆœíšŒí•˜ë©´ì„œ í•´ë‹¹ reqId ì°¾ê¸°
         const tableRows = document.querySelectorAll('#dataTable tbody tr');
         
         tableRows.forEach(function(row) {
             // ê° í–‰ì˜ ê²°ì¬í•˜ê¸° ë²„íŠ¼ì—ì„œ reqId í™•ì¸
             const approveButton = row.querySelector('button[onclick*="' + reqId + '"]');
             
             if (approveButton) {
                 // í•´ë‹¹ í–‰ì„ ì°¾ì•˜ìœ¼ë©´ ì—…ë°ì´íŠ¸
                 console.log('í…Œì´ë¸” í–‰ ì—…ë°ì´íŠ¸ - reqId:', reqId, 'ìƒˆ ìƒíƒœ:', newStatus);
                 
                 // 1. ìƒíƒœ ì»¬ëŸ¼ ì—…ë°ì´íŠ¸ (7ë²ˆì§¸ td)
                 const statusCell = row.querySelector('td:nth-child(7) span');
                 if (statusCell) {
                     statusCell.textContent = newStatus;
                     
                     // CSS í´ë˜ìŠ¤ë„ ë³€ê²½
                     statusCell.className = 'approval-status-badge ';
                     if (newStatus === 'ìŠ¹ì¸') {
                         statusCell.className += 'approval-status-approved';
                     } else if (newStatus === 'ë°˜ë ¤') {
                         statusCell.className += 'approval-status-rejected';
                     }
                 }
                 
                 // 2. ê²°ì¬ ì™„ë£Œì¼ì ì»¬ëŸ¼ ì—…ë°ì´íŠ¸ (6ë²ˆì§¸ td)
                 const dateCell = row.querySelector('td:nth-child(6)');
                 if (dateCell) {
                     const today = new Date();
                     const formattedDate = today.getFullYear() + '-' + 
                                         String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                                         String(today.getDate()).padStart(2, '0');
                     dateCell.textContent = formattedDate;
                 }
                 
                 // 3. ê²°ì¬í•˜ê¸° ë²„íŠ¼ ì œê±° (8ë²ˆì§¸ td)
                 const actionCell = row.querySelector('td:nth-child(8)');
                 if (actionCell) {
                     actionCell.innerHTML = ''; // ë²„íŠ¼ ì œê±°
                 }
             }
         });
     }
        </script>
    </th:block>
</body>
</html>