<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <!-- 개별페이지 CSS 영역 -->
    <th:block layout:fragment="style">
        <!--        <link rel="stylesheet" th:href="@{/css/item_main.css}" />-->
    </th:block>
    
</head>
<body>
<th:block layout:fragment="content">
    <!-- Begin Page Content -->
    <div class="container-fluid">
    	<!-- DataTales Example -->
		<div class="container-fluid">
			<section class="section">
				<div class="card shadow mb-4">
					<div class="card-header py-3">
						<h6 class="m-0 font-weight-bold">조직도</h6>
					</div>

					<!-- Content Area -->
					<div class="card-body">
						<div class="d-flex" style="gap: 10px;">
							<!-- 좌측 영역: 부서 목록 -->
							<div class="dept-list">
       							<select id="deptSelect" size="5" onchange="loadEmployees(this.value)">
           							<option th:each="dept : ${departments}"
                   							th:value="${dept.id}"
                   							th:text="${dept.name}">
									</option>
      							 </select>
   							</div>

							<!-- 테이블 -->
							<div class="flex-grow-1" style="display: block; max-height: 700px; overflow-y: auto; width: 100%; height: auto;">
								<table class="table table-bsordered">
									<thead>
										<tr class="empTable">
											<th>사원번호</th>
											<th>부서명</th>
											<th>직책</th>
											<th>이름</th>
											<th>전화번호</th>
											<th>이메일</th>
										</tr>
									</thead>
									<tbody id="empTableBody">
										<tr th:each="emp : ${employees}">
										    <td th:text="${emp.empNo}"></td>
										    <td th:text="${emp.deptName}"></td>
										    <td th:text="${emp.position}"></td>
										    <td th:text="${emp.name}"></td>
										    <td th:text="${emp.phone}"></td>
										    <td th:text="${emp.email}"></td>
										 </tr>					
									</tbody>
								</table>
								
								<script>
								    function loadEmployees(deptId) {
								        fetch('/employees?deptId=' + deptId)
								            .then(response => response.json())
								            .then(data => {
								                const tbody = document.getElementById('empTableBody');
								                tbody.innerHTML = '';
								                data.forEach(emp => {
								                    tbody.innerHTML += `
								                        <tr>
								                            <td>${emp.empNo}</td>
								                            <td>${emp.deptName}</td>
								                            <td>${emp.position}</td>
								                            <td>${emp.name}</td>
								                            <td>${emp.phone}</td>
								                            <td>${emp.email}</td>
								                        </tr>
								                    `;
								                });
								            });
								    }
								</script>
								
							</div>
						</div>

						<!-- 페이지네이션 -->
						<section id="pageList"></section>
					</div>
				</div>
			</section>
		</div>
	</div>
</th:block>

<th:block layout:fragment="script">

</th:block>
</body>
</html>
