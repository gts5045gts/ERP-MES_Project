<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <!-- 개별페이지 CSS 영역 -->
    <th:block layout:fragment="style">
    </th:block>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
<link href="/personnel/css/personnel.regist.css" rel="stylesheet" type="text/css">
    
</head>
<body>
<th:block layout:fragment="content">
    <!-- Begin Page Content -->
   <section class="section">
			
				<div class="card shadow mb-4" id="empsize">
					<div class="card-header py-3">
						<h6 class="m-0 font-weight-bold">인사등록</h6>
					</div>

					<div class="card-body" id="cbody">
						<br>
						<div class="text-left regist_title">
							<h1 class="h4 text-gray-900 mb-4">
								<i class="fa-solid fa-pen"></i> 기본정보</h1>
						</div>

						<form th:action="@{/personnel/registPro}" id="registForm" name="registForm" method="post" enctype="multipart/form-data">
							<table class="eTable">
								<tbody>
									<tr>
										<!--******************* 사진 *******************-->
										<td rowspan="3" class="text-center">
											<div class="photo-wrapper1">
												<img id="pFIle" name="pFIle" alt="">
											</div>
										</td>
										<!-- 이름 -->
										<th scope="row" class="custom-th">
											<label for="emp_nm" class="form-label">이름</label></th>
										<td colspan="3" class="custom-td">
											<input type="text" class="form-control w-75" id="emp_nm" name="name"></td>

										<!-- 전화번호 -->
										<th scope="row" class="custom-th">
											<label for="emp_ph" class="form-label">전화번호</label></th>
										<td colspan="3" class="custom-td">
											<input type="text" class="form-control w-75" id="emp_ph" name="phone">
											<span id="checkPhoneResult"></span>
										</td>

										<!-- 생년월일 -->
										<th scope="row" class="custom-th">
											<label for="emp_bd" class="form-label">주민등록번호</label></th>
										<td colspan="3" class="custom-td">
											<input type="text" class="form-control w-75" id="emp_bd" name="resident" placeholder="(ex) 990101-1111111" maxlength="14"></td>
									</tr>

									<tr>
										<!-- 성별 -->
										<th scope="row" class="custom-th">
											<label for="emp_bd" class="form-label">패스워드</label></th>
										<td colspan="3" class="custom-td">
											<input type="text" class="form-control w-75" id="emp_bd" name="passwd" placeholder="패스워드 입력" ></td>
										<!-- 이메일 -->
										<th scope="row">
											<label for="emp_em" class="form-label">이메일</label></th>
										<td colspan="3">
											<input type="text" class="form-control w-75" id="emp_em" name="email" placeholder="aaa@naver.com">
											<span id="checkEmailResult"></span>
										</td>
										<!-- 재직현황 -->
										<th scope="row">
											<label for="emp_yn" class="form-label">재직현황</label></th>
										<td colspan="3">
											<select id="emp_yn" name="staId" class="form-select w-75">
												<th:block th:each=" status: ${status}">
													<option th:value="${status.comDtId}" th:text="${status.comDtNm}">
												</th:block>
												
											</select>
										</td>
									</tr>
								</tbody>
								<tbody>
									<tr>
										<!-- ******************첨부파일*************************-->
										<td rowspan="3" class="text-center">
											<div class="photo-wrapper-regist">
												<input class="form-control" type="file" id="emp_pi" name="file1" onchange="employeePhoto(event);">
											</div>
										</td>

										<!-- 부서명 -->
										<th scope="row" class="custom-th">
											<label for="dep_nm" class="form-label">부서명</label></th>
										<td colspan="3">
											<select id="dep_nm" name="deptId" class="form-select w-75">
												<option value="1">부서명을 선택하세요</option>
												<th:block th:each="departments : ${departments}">
													<option th:value="${departments.comDtId}" th:text="${departments.comDtNm}">
												</th:block>
											</select>
										</td>

										<!-- 직책 -->
										<th scope="row" class="custom-th">
											<label for="emp_gd" class="form-label">직책</label></th>
										<td colspan="3">
											<select id="emp_gd" name="posId" class="form-select w-75">
												<option value="1">직책을 선택하세요</option>
												<th:block th:each="position : ${position}">
													<option th:value="${position.comDtId}" th:text="${position.comDtNm}">
												</th:block>
											</select>
										</td>
										<!-- 보안등급 	-->
									
										<th scope="row" class="custom-th">
											<label for="emp_lv" class="form-label">보안등급</label></th>
										<td colspan="3">
											<select id="emp_lv" name="levId" class="form-select w-75">
												<option value="">보안등급을 선택하세요</option>
												<th:block th:each="level : ${level}">
													<option th:value="${level.comDtId}" th:text="${level.comDtNm}">
												</th:block>
											</select>
										</td>
									
									</tr>

									<tr>
										<!-- 우편번호 -->
										<th scope="row">
											<label for="emp_pc" class="form-label">우편번호</label></th>
										<td colspan="3">
											<input type="text" class="form-control w-75" id="emp_pc" name="addrNum"></td>
										<td colspan="3">
											<button type="button" class="btn btn-primary btn-sm" id="btnSearchAddress">주소검색</button>
										</td>
									</tr>

									<tr>
										<!-- 기본주소 -->
										<th scope="row" class="custom-th">
											<label for="emp_ad" class="form-label">기본주소</label></th>
										<td colspan="3" class="custom-td">
											<input type="text" class="form-control w-75" id="emp_ad" name="addr1"></td>
										<!-- 상세주소 -->
										<th scope="row" class="custom-th">
											<label for="emp_ba" class="form-label">상세주소</label></th>
										<td colspan="3" class="custom-td">
											<input type="text" class="form-control w-75" id="emp_ba" name="addr2"></td>
											
											<th scope="row" class="custom-th-r">
											<label for="emp_hd" class="form-label">입사일</label></th>
										<td colspan="3" class="custom-td">
											<input type="date" class="form-control w-75" id="emp_hd" name="joinDate"></td>
									</tr>
								</tbody>
							</table>
						
							<br> <br>
							<div align="right">
								<button type="button" class="btn btn-secondary btn-icon-split" onclick="history.back()">취소</button>
								<button type="submit" class="btn btn-primary btn-sm" id="registerBtn">등록</button>
							</div>
						</form>

					</div>
					<!-- <div class="card-body"> 끝 -->
				</div>
			</section>
</th:block>

<th:block layout:fragment="script">
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>

	// 전화번호 유효성 검사 
	document.getElementById('emp_ph').addEventListener('input', function(e) {
  		let input = e.target.value.replace(/\D/g, ''); // 숫자 이외의 문자는 모두 제거
  
		// 최대 11자리까지 허용 (예: 01012345678)
		if (input.length > 11) {
			input = input.substring(0, 11);
		}
  		
		let formatted = '';
		// 입력된 숫자 길이에 따라 하이픈(-)을 삽입합니다.
		if (input.length < 4) { // 예: 010
			formatted = input;
		} else if (input.length < 7) {	// 예: 010-123
			formatted = input.substring(0, 3) + '-' + input.substring(3);
		} else if (input.length < 11) {	// 예: 010-123-456
			formatted = input.substring(0, 3) + '-' + input.substring(3, 6) + '-' + input.substring(6);
		} else {	// 예: 010-1234-5678 (11자리일 경우)
			formatted = input.substring(0, 3) + '-' + input.substring(3, 7) + '-' + input.substring(7);
		}

		// 포맷팅된 결과를 다시 input에 반영
		e.target.value = formatted;
	});
	
	/**
	// 주민등록 번호
	document.getElementById('emp_bd').addEventListener('input', function(e) {
  		let input = e.target.value.replace(/\D/g, ''); // 숫자 이외의 문자는 모두 제거
  
		// 최대 11자리까지 허용 (예: 01012345678)
		if (input.length > 13) {
			input = input.substring(0, 13);
		}
  		
		let formatted = '';
		// 입력된 숫자 길이에 따라 하이픈(-)을 삽입합니다.
		if (input.length < 6) { // 예: 010
			formatted = input;
		} else  {	// 예: 010-123
			formatted = input.substring(0, 6) + '-' + input.substring(6);
		} 

		// 포맷팅된 결과를 다시 input에 반영
		e.target.value = formatted;
	});
	**/
	document.getElementById('emp_bd').addEventListener('input', function(e) {
	  	let input = e.target.value.replace(/\D/g, ''); // 숫자만 남김

		// 최대 13자리까지만 허용
		if (input.length > 13) {
			input = input.substring(0, 13);
		}

		let formatted = '';
		if (input.length <= 6) {
			// 앞 6자리만 입력 중
			formatted = input;
		} else if (input.length === 7) {
			// 앞 6자리 + '-' + 뒷번호 첫 글자
			formatted = input.substring(0, 6) + '-' + input.charAt(6);
		} else {
			// 앞 6자리 + '-' + 뒷번호 첫 글자 + ****** (항상 6개)
			let front = input.substring(0, 6);
			let firstBack = input.charAt(6);
			formatted = front + '-' + firstBack + '******';
		}

		e.target.value = formatted;
	});
	
	
	// 주소검색
	let btnSearchAddress = document.querySelector('#btnSearchAddress');
	btnSearchAddress.onclick = function() {
		new daum.Postcode({
			oncomplete : function(data) {
				document.querySelector('#emp_pc').value = data.zonecode;

				let addr = data.address;
				if (data.buildingName != "") {
					addr += " (" + data.buildingName + ")";
				}
				document.querySelector('#emp_ad').value = addr;
				document.querySelector('#emp_ba').focus();
			}
		}).open();

	}



	// 사진 등록 함수
	function employeePhoto(event) {
		const file = event.target.files[0]; // 선택된 파일 가져오기
		const reader = new FileReader(); // FileReader 객체 생성

		reader.onload = function() {
			const imgElement = document.getElementById("pFIle");
			imgElement.src = reader.result; // 미리보기 이미지 변경
			imgElement.style.width = "100%"; // 부모 요소에 맞게 조정
			imgElement.style.height = "100%";
			imgElement.style.objectFit = "cover"; // 비율 유지하면서 꽉 차게
		}

		if (file) {
			reader.readAsDataURL(file); // 파일을 읽어서 미리보기
		}
	}
	
// 	  '.notice-title'를 클릭하면 '.notice-list'에 .show 클래스를 토글
	document.querySelector('.notice-title').addEventListener('click', function() {
	document.querySelector('.notice-list').classList.toggle('show');
	});
	
</script>
</th:block>
</body>
</html>
